<?xml version="1.0" encoding="US-ASCII"?>
<!-- This template is for creating an Internet Draft using xml2rfc,
     which is available here: http://xml.resource.org. -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!-- One method to get references from the online citation libraries.
     There has to be one entity for each item to be referenced.
     An alternate method (rfc include) is described in the references. -->

<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC3552 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3552.xml">
<!ENTITY RFC4860 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4860.xml">
<!ENTITY RFC4861 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4861.xml">
<!ENTITY RFC4862 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4862.xml">
<!ENTITY RFC3315 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3315.xml">
<!ENTITY RFC3633 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3633.xml">
<!ENTITY RFC3646 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3646.xml">
<!ENTITY RFC4075 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4075.xml">
<!ENTITY RFC4193 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4193.xml">
<!ENTITY RFC5625 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5625.xml">
<!ENTITY RFC4294 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4294.xml">
<!ENTITY RFC4605 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4605.xml">
<!ENTITY RFC2080 SYSTEM
         "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2080.xml">
<!ENTITY I-D.ietf-v6ops-cpe-simple-security SYSTEM
     "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-v6ops-cpe-simple-security.xml">
<!ENTITY I-D.ford-behave-top SYSTEM
     "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ford-behave-top.xml">

]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!-- used by XSLT processors -->
<!-- For a complete list and description of processing instructions (PIs),
     please see http://xml.resource.org/authoring/README.html. -->
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.
     (Here they are set differently than their defaults in xml2rfc v1.32) -->
<?rfc strict="yes" ?>
<!-- give errors regarding ID-nits and DTD validation -->
<!-- control the table of contents (ToC) -->
<?rfc toc="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="4"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space
     (using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<rfc category="info" docName="draft-ietf-v6ops-cpe-router-02" ipr="trust200902">
  <!-- category values: std, bcp, info, exp, and historic
     ipr values: full3667, noModification3667, noDerivatives3667
     you can add the attributes updates="NNNN" and obsoletes="NNNN"
     they will automatically be output with "(if approved)" -->

  <!-- ***** FRONT MATTER ***** -->

  <front>
    <!-- The abbreviated title is used in the page header - it is only
         necessary if the full title is longer than 39 characters -->

    <title abbrev="Abbreviated Title">Requirements for IPv6 Customer Edge
    Routers</title>

    <!-- add 'role="editor"' below for the editors if appropriate -->
    <!-- Another author who claims to be an editor -->

    <author fullname="Ole Troan" initials="O." role="editor" surname="Troan">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>Veversmauet 8</street>
          <city>BERGEN</city>
          <region></region>
          <code>5017</code>
          <country>Norway</country>
        </postal>
        <phone></phone>
        <email>ot@cisco.com</email>
        <!-- uri and facsimile elements may also be added -->
      </address>
    </author>

    <date month="October" year="2009" />

    <!-- If the month and year are both specified and are the current ones,
         xml2rfc will fill in the current day for you. If only the current
         year is specified, xml2rfc will fill in the current day and month for
         you. If the year is not the current one, it is necessary to specify
         at least a month (xml2rfc assumes day="1" if not specified for the
         purpose of calculating the expiry date).  With drafts it is normally
         sufficient to specify just the year. -->

    <!-- Meta-data Declarations -->

    <area>General</area>

    <workgroup>Internet Engineering Task Force</workgroup>

    <!-- WG name at the upperleft corner of the doc, IETF is fine for
         individual submissions.  If this element is not present, the default
         is "Network Working Group", which is used by the RFC Editor as a nod
         to the history of the IETF. -->

    <keyword>template</keyword>

    <!-- Keywords will be incorporated into HTML output files in a meta tag
         but they have no effect on text or nroff output. If you submit your
         draft to the RFC Editor, the keywords will be used for the search
         engine. -->

    <abstract>
      <t>This document specifies requirements for an IPv6 Customer Premises
      Equipment (CPE) router. Specifically, the current version of this
      document focuses on the provisioning of an IPv6 CPE router and the
      provisioning of IPv6 hosts attached to it.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>This document defines IPv6 features for a residential or small office
      router referred to as an IPv6 CPE Router. Typically, CPE routers support
      IPv4. IPv4 support is not discussed any further in this document. An
      IPv6 CPE Router is an IPv6 node and MUST follow
      the <xref target="RFC4294">IPv6 Node Requirements</xref>
      specification.</t>

      <t>This document specifes how an IPv6 CPE router automatically
      provisions its upstream interface, acquires an address block for
      provisioning of its downstream interfaces and fetches other
      configuration information from the service provider network. Automatic
      provisioning of any more complex topology than a single router with
      multiple downstream interfaces is out of scope for this document. In
      IPv6 with the use of global addressing, addresses are inherently
      transient. The implication of that for a complex network topology with
      multiple levels of routers is that network wide address renumbering
      would have to be made automatic.</t>

      <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119">RFC 2119</xref>.</t>
      </section>
    </section>


    <section title="Terminology">
      <t><list hangIndent="22" style="hanging">
          <t hangText="End-user Network">one or more subnets attached to the
          IPv6 CPE router that connect IPv6 hosts.</t>

          <t hangText="IPv6 Customer Premises Equipment Router">A standalone
          or embedded IPv6 Internet gateway, intended for home or small office
          use, that routes IPv6 traffic from one or more LAN Interfaces to the
          Internet.</t>

          <t hangText="IPv6 Host">a host device such as a personal computer
          that supports IPv6, is located in the home or small office, and
          receives IPv6 Internet connectivity through the IPv6 CPE Router</t>

          <t hangText="LAN Interface">a network interface on a link in the
          customer network.  A LAN Interface could attach to Ethernet, IEEE
          802.11, MoCA 1.0/1.1, and other networks.  An IPv6 CPE Router may
          have one or more network interfaces</t>

          <t hangText="Service Provider">A company that offers its customers
          access to the Internet. In this document, a Service Provider
          specifically offers Internet access using IPv6, and may also offer
          IPv4 Internet access. The Service Provider can provide such access
          over a variety of different transport methods such as DSL, cable,
          wireless, and others.</t>

          <t hangText="WAN Interface">the single physical network interface on
          the IPv6 CPE Router that is used to connect the router to the
          access network of the Service Provider.</t>

      </list></t>
    </section>

    <section title="Architecture">

      <section title="Current IPv4 home network architecture:">

        <t>An end-user network will support both IPv4 and IPv6. It is not
        expected that the existing network topology will be changed with the
        introduction of IPv6. There are some differences in how IPv6 works and
        is provisioned which has implications for the network architecture. A
        typical IPv4 end-user network consist of a "plug and play" NAT box
        connected to the ISP. The assumption is a single NAT device with a
        single link behind it. The NAT provides stable addressing allowing for
        manually configured addresses on the nodes in the end-user
        network. Existing routers support dynamic routing, and advanced home
        users can build arbitrary complex networks. Using manual configuration
        of address prefixes combined with a dynamic routing protocol.</t>

        <t>Apart from the expert user's arbitrary network topology another
        case is the unconventional use of "plug and play" NAT devices to build
        a hierarchical multi-level NAT topology (as described in
        <xref target="I-D.ford-behave-top">Unintended Consequence of two NAT
        deployments with Overlapping Address Space</xref>). Multi-level NAT
        devices are provisioned and addressed automatically and as long as
        these are plugged in as a strict hierarchy it kind of works even
        though conventional network wisdom would tell you otherwise.</t>

        <t>A typical IPv4 NAT deployment gives you by default blocking of all
        incoming connections. Opening of ports is typically allowed using UPnP
        or some other firewall control protocol.</t>

        <t>Another consequence of using private address space in the home is
        that it provides stable addressing, i.e. it never changes even when
        you change ISPs, and the addresses are always there even when the
        upstream link is down or the home border router has not been
        provisioned yet.</t>

        <t>Rewriting addresses on the edge of the network also allows for some
        rudimentary multi-homing; even though using NATs for multi-homing does
        not preserve connections during fail-overs.</t>

        </section>

      <section title="IPv6 end-user network architecture:">

        <t>The home network architecture for IPv6 should provide equivalent or
        better capabilities and functionality than the equivalent IPv4
        architecture. The first phase architecture will not include
        zero-configuration/plug and play routers. I.e. the ability to plug in
        routers in an arbitrary network topology and have these be
        automatically provisioned.</t>

        <t>Issues which may be different in an IPv6 end-user network:</t>

        <t><list style="symbols">
            <t>Addresses in the network before the IPv6 CPE router has been
            provisioned</t>
            <t>Renumbering of address prefix in the network because use of
            global addresses</t>
            <t>Default security policy without NAT</t>
            <t>Support for coupling routers in a hierarchy, aka multi-level
            NATs</t>
        </list></t>

        <t>This architeture describes the:</t>

        <t><list style="symbols">
            <t>Basic capabilities of an IPv6 CPE router and internal
            router</t>
            <t>Provisioning of upstream interface connecting to the ISP</t>
            <t>Provisioning of the downstream interfaces</t>
            <t>Automatic provisioning of a complex topology is outside of
            scope</t>
          </list></t>

        <t>The end-user network is a stub network. Arbitrary topology is
        possible, but is out of scope for this work. Automatic provisioning
        and configuration is described for a single IPv6 CPE router only.</t>

      <figure align="center" anchor="sp_architecture">
        <preamble>An example of a typical end-user network.</preamble>

        <artwork align="left"><![CDATA[

                  +-------+-------+                   \
                  |   Service     |                    \
                  |   Provider    |                     | ISP
                  |    Router     |                     | network
                  +-------+-------+                     |
                          |                             /
                          | Customer                   /
                          | Internet connection       /
                          |
                   +------+--------+                  \
                   |     IPv6      |                   \
                   | Customer Edge |                    \
                   |    Router     |                    /
                   +---+-------+-+-+                   /
       Network A       |       |   Network B          | Customer
 ---+-------------+----+-    --+--+-------------+---  |network(s)
    |             |               |             |      \
+----+-----+ +-----+----+     +----+-----+ +-----+----+  \
|IPv6 Host | |IPv6 Host |     | IPv6 Host| |IPv6 Host |  /
|          | |          |     |          | |          | /
+----------+ +-----+----+     +----------+ +----------+/

            ]]></artwork>

        <postamble></postamble>
      </figure>

      <t>For the purposes of provisioning the IPv6 CPE upstream interface acts
      as a host. It MAY acquire an IPv6 address or addresses using DHCP or
      SLAAC. Other configuration information is acquired using DHCP as
      described in <xref target="RFC3315">RFC3315</xref>. The IPv6 CPE is a
      requesting router for the purposes of prefix delegation and MUST always
      initiate prefix delegation according
      to <xref target="RFC3633">RFC3633</xref>.</t>

      <t>The IPv6 CPE router assigns a /64 from its delegated prefix to each
      of its downstream LAN interfaces. It SHOULD also support assigning a
      Unique Local Address (ULA) to its LAN interfaces for communciation
      within the home network.</t>

      <t>Hosts acquire IPv6 addresses either through SLAAC or DHCP. The IPv6
      CPE router provides configuration information obtained from provisioning
      of the upstream interface to the hosts on the downstream interface(s)
      using DHCP.</t>

      <t>The IPv6 CPE router acting as the demarcation point between two
      networks implements a ULA boundary, multicast zone boundary as well as
      ingress and egress traffic filters.</t>

      <t>An IPv6 CPE router is acting as an IPv6 router for unicast traffic
      and may be configured in an arbitrary topology with a dynamic routing
      protocol. For IPv6 multicast traffic the IPv6 CPE router acts as an MLD
      proxy but MAY support a dynamic multicast routing protocol.</t>

      </section>
    </section>

    <section title="Use Cases and Requirements">
      <section title="WAN side provisioning">
        <t>IPv6 Neighbour Discovery and DHCPv6 protocols operate over any type
        of IPv6 supported link-layer and there is no need for a link-layer
        specific configuration protocol for IPv6 network layer configuration
        options like what's e.g. in PPP IPCP for IPv4. This section makes the
        assumption that the same mechanism will work for any link-layer, be it
        Ethernet, DOCSIS, PPP/PPPoE or others.</t>

        <t>When the router is attached to the upstream link it must act as an
        IPv6 host for the purposes of IPv6 interface initialisation, neighbor
        discovery router discovery, prefix discovery and interface address
        assignment (<xref target="RFC4861">RFC
        4861</xref>/<xref target="RFC4862">RFC 4862</xref>). The router acts
        as a requesting router for the purposes of DHCP prefix delegation
        (<xref target="RFC3633">RFC 3633</xref>).</t>

        <t>The IPV6 CPE router will always initiate DHCP prefix delegation,
        regardless of the M and O-bits in a received Router Advertisement. On
        router-router links were RAs MAY not be used the IPv6 CPE router
        should initiate DHCP PD even when an RA has not been received. Both
        address assignment and prefix delegation should be done within a
        single DHCP session.</t>

        <t>WAN side requirements:<list style='format W-%d:'>

            <t>The IPv6 CPE router MUST support SLAAC
            (<xref target="RFC4862">RFC 4862</xref>).</t>
            <t>The IPv6 CPE router MUST support DHCPv6 address assignment
            (<xref target="RFC3315">RFC3315</xref>).</t>
            <t>If the IPv6 CPE router does not acquire a global IPv6 address
            from either SLAAC or DHCPv6, then it MUST create a global IPv6
            address from the first /64 of its delegated prefix and configure
            that on one of its internal interfaces with an interface
            identifier of ::1.</t>
            <t>The IPv6 CPE router MUST support the following DHCP options:
            Reconfigure Accept(<xref target="RFC3315">RFC3315</xref>),
            DNS_SERVERS (<xref target="RFC3646">RFC3646</xref>), SNTP
            (<xref target="RFC4075">RFC4075</xref>).</t>

            <t>The IPv6 CPE router MUST support DHCP prefix delegation as
            specified in <xref target="RFC3633">RFC3633</xref>.</t>
            <t>The IPv6 CPE MUST use neighbor discovery router discovery and
            install a default route in its RIB for the discovered set of
            routers. In the case where ND is not used on the link, the default
            route MUST be installed with a next-hop being the link-local
            address of the PD delegating router.</t>
            <t>An IPv6 CPE router MAY use BFD in echo mode to verify that the
            ISP provider edge router has correct forwarding information for
            the delegated prefix. When a failure is detected the IPv6 CPE
            router must reinitialise its DHCP PD state machine.</t>
            <t>An IPv6 CPE router MUST not initiate any dynamic routing
            protocol on its WAN interface.</t>

          </list></t>

      </section>
      <section title="LAN side provisioning">

        <t>The IPv6 CPE router distributes configuration information obtained
        during WAN interface provisioning to internal IPv6 hosts and assists
        IPv6 hosts in obtaining IPv6 addresses. It also supports connectivity
        of these devices in the absence of any working WAN interface.</t>

        <t>An IPv6 CPE router will be expected to support an IPv6 end-user
        network and IPv6 hosts that exhibit the following characteristics:</t>

        <t><list style="numbers">
            <t>Link-local addresses are insufficient for allowing IPv6
            applications to communicate with each other in the end-user
            network. The IPv6 CPE router will need to enable this
            communication by providing globally-scoped unicast addresses
            whether or not WAN connectivity exists.</t>

            <t>The IPv6 hosts support SLAAC or DHCP for acquiring their
            addresses.</t>

            <t>The IPv6 hosts will use DHCP for other configuration
            information. Specifically, they will support the DNS_SERVERS
            option for acquiring DNS information.</t>

            <t>End-users commonly place other routers behind the edge IPv6 CPE
            router that provides the IP connection to the service provider
            access network.</t>

        </list></t>

        <t>LAN side requirements:<list style='format L-%d:'>
          <t>The IPv6 CPE router MUST support ULA addressing
          (<xref target="RFC4193">RFC4193</xref>).</t>
          <t>The IPv6 CPE router MUST have a ULA prefix that it maintains
          consistently across reboots. The value of the ULA prefix SHOULD be
          user configurable.</t>
          <t>The IPv6 CPE router MUST support router behavior of Neighbor
          Discover for IPv6 (<xref target="RFC4861">RFC4861</xref>).</t>
          <t>If the IPv6 CPE router is configured to provide ULA addressing to
          IPv6 hosts, it MUST provide a /64 prefix from its ULA prefix in its
          RA message, with A and L bits set to 1.</t>
          <t>The IPv6 CPE router MUST provide an /64 prefix from its delegated
          prefix in its RA message. This prefix MUST have A bit set to 1 and L
          bit set to 1.</t>
          <t>The IPv6 CPE router must assign a separate /64 from its delegated
          prefix for each of its LAN interfaces.</t>

          <t>The IPv6 CPE router MUST support a DHCP server
          (<xref target="RFC3315">RFC 3315</xref>) on its
          LAN interfaces. It SHOULD support DHCP address assignment
          (IA_NA).</t>
          <t>Unless the IPv6 CPE router is configured to support DHCPv6 IA_NA,
          it SHOULD set M=0 and O=1 in its RA messages.</t>
          <t>The IPv6 CPE router MUST support providing DNS information in the
          DHCPv6 DNS_SERVERS option
          (<xref target="RFC3646">RFC3646</xref>).</t>
          <t>If the IPv6 CPE router provides its own IP address to IPv6 hosts
          as the DNS server for those hosts, it MUST implement a DNS Proxy as
          defined in <xref target="RFC5625">RFC5625</xref>.</t>
          <t>The IPv6 CPE router SHOULD pass the additional set of DHCPv6
          options received from the DHCP client on its WAN interface from the
          Service Provider to IPv6 hosts.</t>

          <t>The IPv6 CPE router MAY support DHCP server behavior
          (<xref target="RFC3315">RFC 3315</xref>) for delegated prefix
          (IA_PD) assignment (<xref target="RFC3633">RFC 3633</xref>). This is
          to support another router behind it. No algorithm for selection of a
          prefix to delegate is provided at this time. The IPv6 CPE router can
          have a proprietary delegation mechanism and/or allow the user to
          configure the delegation.</t>

          <t>The IPv6 CPE router MUST support an MLD proxy as specified in
          <xref target="RFC4605">RFC4605</xref>.</t>

          <t>The IPv6 CPE router MAY support a dynamic multicast routing
          protocol.</t>

          <t>The IPv6 CPE router MAY support a dynamic unicast routing
          protocol like <xref target="RFC2080">RIPng</xref>.</t>

          </list></t>

      </section>

      <section title="Transition mechanism support">
      </section>
      <section title="Other capabilites">
        <t>TODO: DNS, Multicast routing, dynamic routing, Managebility,
        UPnP</t>
      </section>
      <section title="Security">
        <t>It is considered a best practice to filter obviously malicious
        traffic (e.g. spoofed packets, "martian" addresses, etc.).  Thus, the
        IPv6 CPE Router should support basic stateless egress and ingress
        filters.  The CPE router should also offer mechanisms to filter
        traffic entering the customer network; however, the method by which
        vendors implement configurable packet filtering is beyond the scope of
        this document.</t>

        <t>Security requirements:<list style='format S-%d:'>
            <t>The CPE Router SHOULD support
            <xref target="I-D.ietf-v6ops-cpe-simple-security">I-D.ietf-v6ops-cpe-simple-security</xref>.</t>
            <t>The CPE Router MUST support ingress filtering in accordance
          with</t>
        </list></t>

      </section>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t></t>
    </section>

    <section anchor="Contributors" title="Contributors">
      <t>Barbara Stark, Chris Donely, Ralph Droms, Hemant Singh, Wes Beebee,
      Kirk Erichsen, Fred Baker, Jason Weil, Howard Lee, Jean-Francois
      Tremblay, Yiu Lee, John Jason Brzozowski, Heather Kirksey.</t>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This memo includes no request to IANA.</t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>All drafts are required to have a security considerations section.
      See <xref target="RFC3552">RFC 3552</xref> for a guide.</t>
    </section>
  </middle>

  <!--  *****BACK MATTER ***** -->

  <back>
    <!-- References split into informative and normative -->

    <!-- There are 2 ways to insert reference entries from the citation
     libraries: 1. define an ENTITY at the top, and use "ampersand
     character"RFC2629; here (as shown) 2. simply use a PI "less than
     character"?rfc include="reference.RFC.2119.xml"?> here (for I-Ds:
     include="reference.I-D.narten-iana-considerations-rfc2434bis.xml")

     Both are cited textually in the same manner: by using xref elements.  If
     you use the PI option, xml2rfc will, by default, try to find included
     files in the same directory as the including file. You can also define
     the XML_LIBRARY environment variable with a value containing a set of
     directories to search.  These can be either in the local filing system or
     remote ones accessed by http (http://domain/dir/... ).-->

    <references title="Normative References">
      <!--?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml"?-->
      &RFC2119;
      &RFC4860;
      &RFC4861;
      &RFC4862;
      &RFC3315;
      &RFC3633;
      &RFC3646;
      &RFC4075;
      &RFC4193;
      &RFC5625;
      &RFC4294;
      &RFC4605;
      &RFC2080;
      &I-D.ietf-v6ops-cpe-simple-security;
    </references>

    <references title="Informative References">
      <!-- Here we use entities that we defined at the beginning. -->

      &RFC3552;
      &I-D.ford-behave-top;
    </references>

    <section anchor="app-additional" title="Items for phase 2">
      <t><list style="symbols">
      <t>Multicast routing</t>
      <t>DNS server</t>
      <t>Hierarchical Prefix Delegation /  plug and play routing</t>
      <t>Advanced security</t>
      <t>IPv6 transition mechanisms</t>
      <t>Service Discovery / Firewall control protocols</t>
      <t>Managability</t>
      </list></t>
    </section>

    <!-- Change Log

v00 2006-03-15  EBD   Initial version

      -->
  </back>
</rfc>
